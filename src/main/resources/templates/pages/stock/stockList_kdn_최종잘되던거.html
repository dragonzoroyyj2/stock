<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">

<head>
  <meta charset="UTF-8">
  <title>주식 종목 리스트</title>

  <!-- Font Awesome은 default_layout에서 이미 포함 -->
  <!-- 공용 CSS는 default_layout에서 이미 포함 -->
</head>

<body>
<div layout:fragment="content">
  <div class="content-container">
    <h2>📊 주식 종목 리스트</h2>

    <!-- 검색 라인 -->
    <div class="toolbar">
      <div class="search-group">
        <input type="text" id="searchInput" placeholder="검색어 입력" />
        <button id="searchBtn" class="btn"><i class="fas fa-search"></i></button>
        <button class="btn"><i class="fas fa-filter"></i></button>
        <button class="btn"><i class="fas fa-sync-alt"></i></button>
      </div>
    </div>

    <!-- 총건 + 기능 버튼 -->
    <div class="list-info">
      <span id="totalCount">총 0건</span>
      <div class="action-buttons">
        <button id="excelBtn" class="btn excel" title="엑셀 다운로드"><i class="fa-solid fa-file-excel"></i></button>
        <button id="addBtn" class="btn" title="추가"><i class="fas fa-plus"></i></button>
        <button id="deleteSelectedBtn" class="btn red" title="삭제"><i class="fas fa-trash"></i></button>
      </div>
    </div>

    <!-- 테이블 -->
    <div class="table-container">
      <table>
        <thead>
        <tr>
          <th><input type="checkbox" id="checkAll" /></th>
          <th>No</th>
          <th>종목코드</th>
          <th>회사명</th>
          <th>시장구분</th>
          <th>업종</th>
          <th>종가</th>
          <th>시가</th>
          <th>고가</th>
          <th>저가</th>
          <th>거래량</th>
          <th>기준일</th>
        </tr>
        </thead>
        <tbody id="dataTable"></tbody>
      </table>
    </div>

    <!-- 페이징 -->
    <div id="pagination" class="pagination"></div>
  </div>

  <!-- 등록 모달 -->
  <div id="addModal" class="modal">
    <div class="elegant-modal">
      <div class="elegant-header">
        <h3>서버 등록</h3>
        <span data-close="addModal" class="close-btn">&times;</span>
      </div>
      <div class="elegant-body">
        <div class="form-group"><label>제목</label><input id="titleInput" /></div>
        <div class="form-group"><label>담당자</label><input id="ownerInput" /></div>
        <div class="form-group"><label>서버 종류</label>
          <select id="serverType"><option>웹 서버</option><option>DB 서버</option><option>API 서버</option></select>
        </div>
        <div class="form-group"><label>운영 상태</label>
          <div class="option-group">
            <label><input type="radio" name="status" value="active" checked>운영</label>
            <label><input type="radio" name="status" value="pause">중지</label>
          </div>
        </div>
        <div class="form-group"><label>기능 옵션</label>
          <div class="option-group">
            <label><input type="checkbox">백업 활성화</label>
            <label><input type="checkbox">자동 모니터링</label>
          </div>
        </div>
        <div class="form-group"><label>등록일</label><input type="date" id="regDateInput" /></div>
        <div class="form-group"><label>비고</label><textarea id="noteInput" rows="3"></textarea></div>
      </div>
      <div class="modal-footer elegant-footer">
        <button id="saveBtn" class="btn">저장</button>
        <button class="btn gray" data-close="addModal">닫기</button>
      </div>
    </div>
  </div>

  <!-- 상세 / 수정 모달 -->
  <div id="detailModal" class="modal">
    <div class="elegant-modal">
      <div class="elegant-header">
        <h3>상세 정보</h3>
        <span data-close="detailModal" class="close-btn">&times;</span>
      </div>
      <div class="elegant-body">
        <div class="form-group"><label>No</label><input id="detailId" readonly /></div>
        <div class="form-group"><label>제목</label><input id="detailTitle" /></div>
        <div class="form-group"><label>담당자</label><input id="detailOwner" /></div>
        <div class="form-group"><label>등록일</label><input id="detailRegDate" readonly /></div>
        <div class="form-group"><label>서버 상태</label>
          <select><option>정상</option><option>점검중</option></select>
        </div>
        <div class="form-group"><label>기능 옵션</label>
          <div class="option-group">
            <label><input type="checkbox">백업 활성화</label>
            <label><input type="checkbox">자동 모니터링</label>
          </div>
        </div>
        <div class="form-group"><label>비고</label><textarea id="detailNote" rows="3"></textarea></div>
      </div>
      <div class="modal-footer elegant-footer">
        <button id="updateBtn" class="btn">수정</button>
        <button class="btn gray" data-close="detailModal">닫기</button>
      </div>
    </div>
  </div>
</div>

<!-- 페이지별 초기화 -->
<th:block layout:fragment="pageScript">

  <script src="/js/commonPagination_op.js"></script>
  <script src="/js/commonUnifiedList_op.js"></script>

 
  
  <script>
     document.addEventListener("DOMContentLoaded", () => {
       function getPageGroupSize() {
         const width = window.innerWidth;
         if (width < 480) return 3;
         if (width < 768) return 5;
         if (width < 1024) return 10;
         return 20;
       }

       let pageGroupSize = getPageGroupSize();

       // ================================
       // 공용 리스트 초기화
       // ================================
       const unifiedListManager = initUnifiedList({
         mode: "server",
         pagination: true,
         apiUrl: "/api/stock/list",
         tableBodySelector: "#dataTable",
         paginationSelector: "#pagination",
         searchInputSelector: "#searchInput",
         searchBtnSelector: "#searchBtn",
         addBtnSelector: "#addBtn",
         deleteSelectedBtnSelector: "#deleteSelectedBtn",
         excelBtnSelector: "#excelBtn",
         columns: [
             { key: "id", label: "No" },
             { key: "Code", label: "종목코드"},
             { key: "Name", label: "회사명" , isDetailLink: true },
             { key: "Market", label: "시장구분" },
             { key: "Dept", label: "업종" },
             { key: "Close", label: "종가" },
             { key: "Open", label: "시가" },
             { key: "High", label: "고가" },
             { key: "Low", label: "저가" },
             { key: "Volume", label: "거래량" },
             { key: "Date", label: "기준일" }
         ],
         pageSize: 10,
         pageGroupSize: pageGroupSize,
         buttons: {
           search: true,
           searchInput: true,
           add: true,
           deleteSelected: true,
           excel: true
         },
		 enableRowClickDetail: false, // 행 전체 클릭으로 상세 보기 활성화
		 // 상세보기만 가능하고, 수정/삭제 버튼 비활성화
		 enableDetailView: true,
		 detailViewButtons: {
		   update: false,
		   delete: false,
		 }
		 
		 
		 
		 // ================================
		 // 이 화면에 특화된 기능 추가
		 // 페이지별로 추가 로직이 필요할 때 직접 addEventListener를 사용하여 기능을 확장
		 // ================================
		 /*
		 관심사 분리 (Separation of Concerns):
		 commonUnifiedList_op.js는 공통 기능(리스트 조회, CRUD, 페이징 등)에만 집중합니다.
		 페이지별 스크립트는 해당 페이지에만 필요한 추가 로직을 담당합니다.
		 이렇게 하면 공통 스크립트가 불필요하게 복잡해지지 않고, 유지보수가 쉬워집니다.
		 유연성:
		 모든 페이지에서 같은 commonUnifiedList_op.js 파일을 사용하면서도, 각 페이지의 요구사항에 맞춰 기능을 자유롭게 추가하거나 변경할 수 있습니다.
		 예를 들어, 어떤 페이지는 추가 버튼이 일반적인 등록 모달을 열지만, 다른 페이지는 사용자 입력이 필요한 커스텀 팝업을 띄울 수 있습니다.
		 코드 충돌 방지:
		 공통 로직과 페이지별 로직이 분리되어 있어, 공통 스크립트를 수정하더라도 특정 페이지의 커스텀 로직에 영향을 주지 않습니다.
		 commonUnifiedList_op.js에서 이벤트 위임을 사용하기 때문에, 페이지별로 추가하는 addEventListener가 공통 로직과 충돌할 가능성이 낮습니다. 
		*/
		
		/*
		 const addUserBtn = document.getElementById("addUserBtn");
		 if (addUserBtn) {
		   addUserBtn.addEventListener("click", () => {
		     alert("사용자 추가 모달을 여는 커스텀 로직");
		     // 사용자 추가 로직 (예: 별도의 API 호출, 특정 폼 초기화 등)
		   });
		 }

		 const customFilterBtn = document.getElementById("customFilterBtn");
		 if (customFilterBtn) {
		   customFilterBtn.addEventListener("click", () => {
		     alert("커스텀 필터링 로직 실행");
		     // 필터링 로직 구현 (예: 특정 파라미터를 추가하여 loadList 호출)
		   });
		 }
		 */

		 // unifiedListManager 객체를 활용하여 공통 기능에 접근 가능
		 // console.log(unifiedListManager.currentPage);
		 
       });
	   
	   
	   // unifiedListManager 객체를 활용하여 공통 기능에 접근 가능
	   console.log(unifiedListManager.currentPage);
	   
       // ================================
       // 화면 리사이즈 시 페이지 그룹 재조정
       // ================================
       window.addEventListener("resize", () => {
         const newGroupSize = getPageGroupSize();
         if (newGroupSize !== pageGroupSize) {
           pageGroupSize = newGroupSize;
           unifiedListManager.pageGroupSize = newGroupSize;
           const event = new Event("resizePagination");
           document.dispatchEvent(event);
         }
       });
     });
   </script>
  
  
</th:block>

</body>
</html>

