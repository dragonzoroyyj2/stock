<div th:fragment="leftFragment">
  <!-- ✅ 사이드바 -->
  <nav id="left" class="sidebar closed">
    <ul>
      <li><a href="/pages/main/base"><i class="fas fa-home"></i><span>홈</span></a></li>

      <li class="has-submenu">
        <a href="#" class="submenu-toggle"><i class="fas fa-file-alt"></i><span>리포트 관리</span></a>
        <ul class="submenu">
          <li><a href="/pages/p01/p01a04/p01a04List">리포트 목록</a></li>
          <li class="has-submenu">
            <a href="#" class="submenu-toggle">리포트 통계</a>
            <ul class="submenu">
              <li><a href="#">일별 통계</a></li>
              <li class="has-submenu">
                <a href="#" class="submenu-toggle">월별 통계</a>
                <ul class="submenu">
                  <li><a href="#">1월</a></li>
                  <li><a href="#">2월</a></li>
                  <li class="has-submenu">
                    <a href="#" class="submenu-toggle">상세 통계</a>
                    <ul class="submenu">
                      <li><a href="#">부서별</a></li>
                      <li><a href="#">개인별</a></li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>


		<li class="has-submenu">
		    <a href="#"><i class="fas fa-chart-line"></i><span>주식 관리</span></a>
		    <ul class="submenu">
		        <!-- 기존 유사 종목 차트 -->
		        <li><a href="/pages/stock/krx_list">종목 리스트</a></li>
		        <li><a href="/pages/stock/stock01">유사 종목 차트</a></li>
				<li><a href="/pages/stock/similar-advanced">유사 종목 차트리얼</a></li>
		
		        <!-- 테스트 화면 추가 -->
		        <li><a href="/pages/stock/stock_test1">테스트 화면 1</a></li>
		        <li><a href="/pages/stock/stock_test2">테스트 화면 2</a></li>
		        <li><a href="/pages/stock/stock_test3">테스트 화면 3</a></li>
		
		        <!-- 주식 리포트 기존 메뉴 -->
		        <li class="has-submenu">
		            <a href="#" class="submenu-toggle">주식 리포트</a>
		            <ul class="submenu">
		                <li><a href="/pages/stocks/report/daily">일별 리포트</a></li>
		                <li><a href="/pages/stocks/report/monthly">월별 리포트</a></li>
		                <li class="has-submenu">
		                    <a href="#" class="submenu-toggle">상세 리포트</a>
		                    <ul class="submenu">
		                        <li><a href="/pages/stocks/report/sector">섹터별</a></li>
		                        <li><a href="/pages/stocks/report/individual">개별 종목</a></li>
		                    </ul>
		                </li>
		            </ul>
		        </li>
		        <li><a href="/pages/stocks/history">거래 내역</a></li>
		    </ul>
		</li>

	  
	  

      <li class="has-submenu">
        <a href="#" class="submenu-toggle"><i class="fas fa-cog"></i><span>설정</span></a>
        <ul class="submenu">
          <li><a href="/pages/sy/syusr/syusr01List">사용자 관리</a></li>
          <li><a href="#">권한 설정</a></li>
        </ul>
      </li>
    </ul>
  </nav>

  <!-- ✅ 오버레이 -->
  <div id="sidebarOverlay"></div>

  <style>
    .sidebar {
      position: fixed;
      top: 50px;
      left: 0;
      width: 240px;
      height: calc(100% - 50px);
      background: #f3f4f6;
      border-right: 1px solid #d1d5db;
      overflow-y: auto;
      transform: translateX(-240px);
      transition: transform 0.3s ease;
      z-index: 3000;
    }
    .sidebar.open { transform: translateX(0); }

    #sidebarOverlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.35);
      z-index: 2500;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    #sidebarOverlay.active {
      display: block; opacity: 1;
    }

    .sidebar ul { list-style: none; margin: 0; padding: 0; }
    .sidebar li { border-bottom: 1px solid #e5e7eb; }
    .sidebar li a {
      display: flex; align-items: center; gap: 10px;
      padding: 12px 18px;
      color: #374151; text-decoration: none;
      transition: background 0.2s, color 0.2s;
    }
    .sidebar li a:hover { background: #e5e7eb; color: #111827; }

    .has-submenu > a::after {
      content: "▾";
      margin-left: auto;
      font-size: 0.8rem;
      transition: transform 0.2s ease;
    }
    .has-submenu.open > a::after {
      transform: rotate(180deg);
    }

    .submenu { display: none; background: #e5e7eb; }
    .has-submenu.open > .submenu { display: block; }

    /* 단계별 들여쓰기 */
    .submenu a { padding-left: 30px; background: #e6e9f0; }
    .submenu .submenu a { padding-left: 45px; background: #e3e5ec; }
    .submenu .submenu .submenu a { padding-left: 60px; background: #dee1e8; }
    .submenu .submenu .submenu .submenu a { padding-left: 75px; background: #d9dce4; }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const sidebar = document.querySelector(".sidebar");
      const overlay = document.getElementById("sidebarOverlay");

      // ✅ 전역 토글 함수 (top.html에서 호출)
      window.toggleSidebar = function () {
        const isOpen = sidebar.classList.contains("open");
        sidebar.classList.toggle("open", !isOpen);
        overlay.classList.toggle("active", !isOpen);
      };

      // ✅ 오버레이 클릭 시 닫기
      overlay.addEventListener("click", () => {
        sidebar.classList.remove("open");
        overlay.classList.remove("active");
      });

      // ✅ 모든 a 태그 처리 (하위 메뉴 여부에 따라 다르게)
      document.querySelectorAll(".sidebar li > a").forEach(link => {
        link.addEventListener("click", e => {
          const parentLi = link.parentElement;
          const hasSubmenu = parentLi.classList.contains("has-submenu");
          const submenu = parentLi.querySelector(":scope > .submenu");

          if (hasSubmenu && submenu) {
            // 👉 하위 메뉴가 있으면 펼치기/닫기만
            e.preventDefault();
            e.stopPropagation();
            parentLi.classList.toggle("open");
          } else {
            // 👉 실제 페이지 이동 링크면 그대로 이동
            // (여기선 따로 막지 않음, href 동작 그대로)
            // 필요 시 모바일 전용 자동 닫기 조건 가능:
            // if (window.innerWidth < 768) {
            //   sidebar.classList.remove("open");
            //   overlay.classList.remove("active");
            // }
          }
        });
      });
    });
  </script>
</div>
